{% load static %}
<div id="sidemenu_wrapper">
  <div id="sidemenu">
    <div class="close">
      <svg
        width="56"
        height="56"
        viewBox="0 0 56 56"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M31.2668 28L45.9668 13.3C46.9002 12.3666 46.9002 10.9666 45.9668 10.0333C45.0335 9.09998 43.6335 9.09998 42.7002 10.0333L28.0002 24.7333L13.3002 10.0333C12.3668 9.09998 10.9668 9.09998 10.0335 10.0333C9.10016 10.9666 9.10016 12.3666 10.0335 13.3L24.7335 28L10.0335 42.7C9.56683 43.1666 9.3335 43.6333 9.3335 44.3333C9.3335 45.7333 10.2668 46.6666 11.6668 46.6666C12.3668 46.6666 12.8335 46.4333 13.3002 45.9666L28.0002 31.2666L42.7002 45.9666C43.1668 46.4333 43.6335 46.6666 44.3335 46.6666C45.0335 46.6666 45.5002 46.4333 45.9668 45.9666C46.9002 45.0333 46.9002 43.6333 45.9668 42.7L31.2668 28Z"
          fill="white"
        />
      </svg>
    </div>
    <ul>
      <li><a href="{% url 'concertinfo' %}">공연정보</a></li>
      {% if user.is_authenticated %}
        {% if not has_reservation %}
          <li id="join-queue-btn"><a href="{% url 'waiting_room' %}">예매하기</a></li>
        {% endif %}
        <li><a href="{% url 'reservationlog' %}">예매내역</a></li>
      {% endif %}
      <li><a href="{% url 'notice' %}">공지사항</a></li>
    </ul>
  </div>
</div>

<script>
  function checkTime() {
    const now = new Date();
    const seoulTime = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Seoul"}));
    const targetTime = new Date('2024-07-31T11:21:00+09:00'); // Seoul time (KST)
    const joinQueueBtn = document.getElementById('join-queue-btn');

    if (seoulTime >= targetTime && joinQueueBtn) {
      joinQueueBtn.style.display = 'block';
    }
  }

  // Check time immediately
  checkTime();

  // Check time every minute
  setInterval(checkTime, 60000);


  document.getElementById('join-queue-btn').addEventListener('click', function(e) {
      e.preventDefault();
      fetch('{% url "join_queue" %}', {
          method: 'POST',
          headers: {
              'X-CSRFToken': '{{ csrf_token }}',
              'Content-Type': 'application/json',
          },
      })
      .then(response => response.json())
      .then(data => {
          if (data.success) {
              window.location.href = '{% url "waiting_room" %}';
          } else {
              alert('대기열 입장에 실패했습니다: ' + data.error);
          }
      });
  });
  </script>